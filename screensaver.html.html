<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Reloj + Tiempo (Villarrubia de los Ojos)</title>
  <style>
    :root { color-scheme: dark; }
    body{
      margin:0; height:100vh; display:flex; align-items:center; justify-content:center;
      background:#000; color:#fff; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    .wrap{ text-align:center; padding:4vw; }
    .city{ font-size: clamp(18px, 2.2vw, 28px); opacity:.85; letter-spacing:.02em; }
    .time{ font-size: clamp(64px, 10vw, 160px); font-weight: 700; line-height: 1; margin:.15em 0 .05em; }
    .date{ font-size: clamp(18px, 2.4vw, 34px); opacity:.85; margin-bottom: .9em; }
    .card{
      display:inline-block; text-align:left; border:1px solid rgba(255,255,255,.18);
      border-radius: 18px; padding: 18px 20px; min-width: min(560px, 88vw);
      background: rgba(255,255,255,.06);
      backdrop-filter: blur(6px);
    }
    .row{ display:flex; gap:16px; flex-wrap:wrap; align-items:baseline; justify-content:space-between; }
    .big{
      font-size: clamp(24px, 3.2vw, 44px); font-weight: 700;
    }
    .muted{ opacity:.8; }
    .kv{ font-size: clamp(16px, 2vw, 22px); margin-top: 10px; display:flex; gap:18px; flex-wrap:wrap; }
    .kv span{ white-space:nowrap; }
    .footer{ margin-top: 10px; font-size: 14px; opacity:.6; }
    .err{ color:#ffb4b4; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="city">Villarrubia de los Ojos ¬∑ Espa√±a</div>
    <div id="time" class="time">--:--</div>
    <div id="date" class="date">--</div>

    <div class="card">
      <div class="row">
        <div>
          <div class="muted">Ahora</div>
          <div id="temp" class="big">--¬∞C</div>
        </div>
        <div style="text-align:right">
          <div id="desc" class="muted">Cargando tiempo‚Ä¶</div>
          <div id="today" class="muted">M√°x --¬∞ / M√≠n --¬∞</div>
        </div>
      </div>

      <div class="kv">
        <span id="wind">üí® Viento: -- km/h</span>
        <span id="rain">üåßÔ∏è Lluvia: -- mm</span>
        <span id="pop">‚òî Prob. precip.: --%</span>
      </div>

      <div id="status" class="footer">Actualizando‚Ä¶</div>
    </div>
  </div>

<script>
  // --- Config ---
  const LAT = 39.2181;     // Villarrubia de los Ojos (aprox.)
  const LON = -3.6077;
  const TZ  = "Europe/Madrid";
  const CITY_LABEL = "Villarrubia de los Ojos";

  // Weather code mapping (Open-Meteo WMO)
  const WMO_ES = {
    0:"Despejado",
    1:"Principalmente despejado",
    2:"Parcialmente nublado",
    3:"Nublado",
    45:"Niebla",
    48:"Cencellada",
    51:"Llovizna ligera",
    53:"Llovizna moderada",
    55:"Llovizna intensa",
    56:"Llovizna helada ligera",
    57:"Llovizna helada intensa",
    61:"Lluvia ligera",
    63:"Lluvia moderada",
    65:"Lluvia intensa",
    66:"Lluvia helada ligera",
    67:"Lluvia helada intensa",
    71:"Nieve ligera",
    73:"Nieve moderada",
    75:"Nieve intensa",
    77:"Granizo/nieve granulada",
    80:"Chubascos ligeros",
    81:"Chubascos moderados",
    82:"Chubascos intensos",
    85:"Chubascos de nieve ligeros",
    86:"Chubascos de nieve intensos",
    95:"Tormenta",
    96:"Tormenta con granizo (ligero)",
    99:"Tormenta con granizo (fuerte)"
  };

  // --- Clock ---
  function tickClock(){
    const now = new Date();
    const timeFmt = new Intl.DateTimeFormat("es-ES", {
      hour:"2-digit", minute:"2-digit", hour12:false, timeZone: TZ
    }).format(now);
    const dateFmt = new Intl.DateTimeFormat("es-ES", {
      weekday:"long", year:"numeric", month:"long", day:"numeric", timeZone: TZ
    }).format(now);

    document.getElementById("time").textContent = timeFmt;
    document.getElementById("date").textContent = dateFmt.charAt(0).toUpperCase() + dateFmt.slice(1);
  }
  tickClock();
  setInterval(tickClock, 1000);

  // --- Weather ---
  function fmt(n){ return (n ?? "--"); }
  function setStatus(txt, isErr=false){
    const el = document.getElementById("status");
    el.textContent = txt;
    el.className = "footer" + (isErr ? " err" : "");
  }

  async function loadWeather(){
    try{
      setStatus("Actualizando tiempo‚Ä¶");
      const url =
        "https://api.open-meteo.com/v1/forecast"
        + `?latitude=${LAT}&longitude=${LON}`
        + `&timezone=${encodeURIComponent(TZ)}`
        + "&current=temperature_2m,weather_code,wind_speed_10m,precipitation"
        + "&daily=temperature_2m_max,temperature_2m_min,precipitation_probability_max"
        + "&forecast_days=1";

      const r = await fetch(url, { cache: "no-store" });
      if(!r.ok) throw new Error("HTTP " + r.status);
      const data = await r.json();

      const cur = data.current || {};
      const daily = (data.daily || {});
      const tmax = daily.temperature_2m_max?.[0];
      const tmin = daily.temperature_2m_min?.[0];
      const pop  = daily.precipitation_probability_max?.[0];

      const temp = cur.temperature_2m;
      const wind = cur.wind_speed_10m;
      const rain = cur.precipitation;
      const code = cur.weather_code;

      document.getElementById("temp").textContent = `${fmt(temp)}¬∞C`;
      document.getElementById("wind").textContent = `üí® Viento: ${fmt(wind)} km/h`;
      document.getElementById("rain").textContent = `üåßÔ∏è Lluvia: ${fmt(rain)} mm`;
      document.getElementById("pop").textContent  = `‚òî Prob. precip.: ${fmt(pop)}%`;

      document.getElementById("desc").textContent = `${CITY_LABEL} ¬∑ ${WMO_ES[code] ?? ("C√≥digo " + fmt(code))}`;
      document.getElementById("today").textContent = `M√°x ${fmt(tmax)}¬∞ / M√≠n ${fmt(tmin)}¬∞`;

      const updated = new Intl.DateTimeFormat("es-ES", {
        hour:"2-digit", minute:"2-digit", hour12:false, timeZone: TZ
      }).format(new Date());
      setStatus(`Actualizado: ${updated}`);
    }catch(e){
      setStatus("No se pudo cargar el tiempo (revisar Wi-Fi).", true);
      console.error(e);
    }
  }

  loadWeather();
  // refresca cada 10 minutos
  setInterval(loadWeather, 10 * 60 * 1000);
</script>
</body>
</html>
